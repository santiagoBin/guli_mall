谷粒商城

## docker-mysql

注意这是mysql5版本的开启方式，mysql8用这个命令开启会报错

![image-20220716104531779](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220716104531779.png)

### mysql8版本(ubuntu)：

~~~shell
sudo docker run  --name mysql  -p 3306:3306  -v /mydata/mysql/data:/var/lib/mysql  -v /mydata/mysql/log:/var/log/mysql  -v /mydata/mysql/my.cnf:/etc/mysql/my.cnf:rw  -e MYSQL_ROOT_PASSWORD=250258  --restart=always  -d mysql:latest

~~~

### centos7:

先建好文件,否则会导致无法启动容器，会被默认建立为一个文件夹：

~~~shell
touch /mydata/mysql/my.cnf
~~~

在docker run中加入 –privileged=true 给容器加上特定权限

~~~shell
docker run  --name mysql --privileged=true -p 3306:3306  -v /mydata/mysql/data:/var/lib/mysql  -v /mydata/mysql/log:/var/log/mysql  -v /mydata/mysql/my.cnf:/etc/mysql/my.cnf:rw  -e MYSQL_ROOT_PASSWORD=250258   -d mysql:latest
~~~

### 查看docker某个容器的启动日志以排查问题：

~~~shell
sudo docker logs --since 30m 0952aad3d653
2022-07-16 03:33:06+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.29-1.el8 started.
2022-07-16 03:33:06+00:00 [ERROR] [Entrypoint]: mysqld failed while attempting to check config
	command was: mysqld --verbose --help --log-bin-index=/tmp/tmp.pFlQvdOoCP
	mysqld: Can't read dir of '/etc/mysql/conf.d/' (OS errno 2 - No such file or directory)
mysqld: [ERROR] Stopped processing the 'includedir' directive in file /etc/my.cnf at line 36.
mysqld: [ERROR] Fatal error in defaults handling. Program aborted!
2022-07-16 03:33:44+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.29-1.el8 started.
2022-07-16 03:33:44+00:00 [ERROR] [Entrypoint]: mysqld failed while attempting to check config
	command was: mysqld --verbose --help --log-bin-index=/tmp/tmp.g0bgHMQ5gA
	mysqld: Can't read dir of '/etc/mysql/conf.d/' (OS errno 2 - No such file or directory)
mysqld: [ERROR] Stopped processing the 'includedir' directive in file /etc/my.cnf at line 36.
mysqld: [ERROR] Fatal error in defaults handling. Program aborted!

~~~

## 控制器

![image-20220716205322149](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220716205322149.png)

## docker安装redis

![image-20220716211200130](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220716211200130.png)

## 新加入一个外部模块

![image-20220716234314221](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220716234314221.png)

![image-20220716234530988](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220716234530988.png)

## pom.xml的plugin里面爆红

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220716235813606.png)

![image-20220717003341151](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220717003341151.png)

![image-20220717003400350](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220717003400350.png)



## pom/relativePath

![image-20220717002957411](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220717002957411.png)

![image-20220717004433065](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220717004433065.png)

![image-20220717004651702](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220717004651702.png)

## 关于配置文件

![image-20220717212731424](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220717212731424.png)

## 调出spring的service启动面板

![image-20220717230237368](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220717230237368.png)

![image-20220717230256367](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220717230256367.png)

## 刷新配置文件值

![image-20220718113521482](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718113521482.png)

## nacos配置中心使用

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718113958408.png)

## 切换命名空间/分组

![image-20220718121551325](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718121551325.png)

### 最佳实践：

![image-20220718122136800](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718122136800.png)

![image-20220718122206513](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718122206513.png)

## 配置集群

![image-20220718122741647](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718122741647.png)

![image-20220718123406926](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718123406926.png)

## 指定默认配置文件的分组

![image-20220718123636059](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718123636059.png)



这样任何配置文件都可以放在nacos中了。

## Gateway

![image-20220718124953314](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718124953314.png)

## ubuntu切换输入法

![image-20220718154404887](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718154404887.png)

## 下载centos

![image-20220718165959490](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718165959490.png)

## centos7安装后联网

![image-20220718182715154](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718182715154.png)

![image-20220718182814210](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718182814210.png)

![image-20220718182828547](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718182828547.png)

## spring工程激活规则

![image-20220718195426750](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718195426750.png)

## centos7中docker运行redis

~~~shell
docker run -p 6379:6379 --name redis --privileged=true -v /mydata/redis/data:/data -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf -d redis redis-server /etc/redis/redis.conf
~~~

## centos无法使用ifconfig

centos无法使用ifconfig命令是因为**安装系统时默认没有安装ifconfig命令**。 解决方法：在终端使用“yum install -y net-tools”命令安装ifconfig包即可。

![image-20220718213635455](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220718213635455.png)



## es5 vs es6

### 解构赋值/箭头函数

![image-20220719093535093](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719093535093.png)

![image-20220719093703239](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719093703239.png)

![image-20220719100025125](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719100025125.png)

### promise解决回调地狱

![image-20220719100155100](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719100155100.png)

![image-20220719100802984](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719100802984.png)

![image-20220719101325350](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719101325350.png)

![image-20220719101346217](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719101346217.png)

#### 链式调用

![image-20220719101759484](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719101759484.png)

![image-20220719101816675](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719101816675.png)

## vue

![image-20220719111054503](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719111054503.png)

![image-20220719111652690](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719111652690.png)

![image-20220719112547597](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719112547597.png)

![image-20220719112855311](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719112855311.png)

![image-20220719113007881](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719113007881.png)

## 引入nacos和openfeign

![image-20220719161900365](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719161900365.png)

## spring-cloud-alibaba版本仲裁

就是可以版本仲裁了。

![image-20220719163201406](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719163201406.png)

![image-20220719225357762](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719225357762.png)

![image-20220719225505522](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719225505522.png)

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719233447248.png)

## maven的type和scope

### 单继承和多引用

maven只能单继承，但是可以多引用。

<scope>import</scope>通常用于多引用pom打包类型的依赖时，只能出现在dependencymanagement中，往往和<type>pom</type>组合用。type和引入依赖的packaging相对应。默认的type和packaging都是jar。如果指明<type>pom</type>

那么就只会引入属性和一些管理的依赖版本，而不引入jar包。因为pom的打包类型的文件中也有可能直接引入依赖而不是只进行依赖

管理。多引用就可以解决单继承导致的继承的父pom中管理了太多的依赖，将依赖管理分散到多个pom里面。

![image-20220719235551823](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719235551823.png)

![image-20220720000317916](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720000317916.png)

### scope

**compile** ：为**默认的**依赖有效范围。如果在定义依赖关系的时候，没有明确指定依赖有效范围的话，则默认采用该依赖有效范围。

此种依赖，在编译、运行、测试时均有效。

**provided** ：在编译、测试时有效，但是在运行时无效。

provided意味着打包的时候可以不用包进去，别的设施(Web Container)会提供。

事实上该依赖理论上可以参与编译，测试，运行等周期。相当于compile，但是在打包阶段做了exclude的动作。

例如：servlet-api，运行项目时，容器已经提供，就不需要Maven重复地引入一遍了。

**runtime** ：在运行、测试时有效，但是在编译代码时无效。

说实话在终端的项目（非开源，企业内部系统）中，和compile区别不是很大。比较常见的如JSR×××的实现，对应的API jar是compile的，具体实现是runtime的，compile只需要知道接口就足够了。

例如：JDBC驱动实现，项目代码编译只需要JDK提供的JDBC接口，只有在测试或运行项目时才需要实现上述接口的具体JDBC驱动。

另外runntime的依赖通常和optional搭配使用，optional为true。我可以用A实现，也可以用B实现。

**test** ：只在测试时有效，包括测试代码的编译，执行。例如：JUnit。

PS: test表示只能在src下的test文件夹下面才可以使用，你如果在a项目中引入了这个依赖，在b项目引入了a项目作为依赖，在b项目中这个注解不会生效，因为scope为test时无法传递依赖。

**system** ：在编译、测试时有效，但是在**运行时无效**。

和provided的区别是，使用system范围的依赖时必须通过**systemPath元素显式地指定依赖文件的路径**。由于此类依赖**不是通过Maven仓库解析的，而且往往与本机系统绑定**，可能造成构建的不可移植，因此应该谨慎使用。

![image-20220719231901122](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719231901122.png)

**不是多继承，是多引用（写错了）：**

![image-20220719235949277](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719235949277.png)

![image-20220720000013186](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720000013186.png)

![image-20220720211638280](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720211638280.png)

![image-20220720212054939](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720212054939.png)



### type

![image-20220719232439297](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719232439297.png)



![image-20220719165607039](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719165607039.png)

## org.springframework.cloud/com.alibaba.cloud

![image-20220719172843892](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719172843892.png)

![image-20220719172951879](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719172951879.png)

![image-20220719173031717](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719173031717.png)

## 使用nacos作为注册和配置中心

![image-20220719174316630](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719174316630.png)

### 坑1：bootstrp.yml不生效

高版本的springboot要使用bootstrap.yml来作为配置文件，务必先引入这个依赖，否则在项目启动时根本不会读取bootstrp.yml。

~~~xml
       <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-bootstrap</artifactId>
            <version>3.1.3</version>
        </dependency>
~~~

### 坑2：正确配置集群写法(yml)

![image-20220719193328667](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719193328667.png)

~~~yaml
spring:
  application:
    name: gulimall-coupon
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
      config:
        namespace: 01d665f4-3dd1-456f-8ff8-727292e5db2c
        extension-configs:
          - data-id: datasource.yml
            refresh: true
            group: dev

          - data-id: mybatis-plus.yml
            refresh: true
            group: dev

          - data-id: other.yml
            refresh: true
            group: dev
        group: prod
~~~

如果是properties文件：extension-configs[0].data-id=....

​										  extension-configs[0].group=....

​										  extension-configs[1].data-id=....

​										  extension-configs[1].group=....



### 坑3：默认读取的配置文件在nacos中的命名

![image-20220719212004300](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719212004300.png)

![image-20220719193537421](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719193537421.png)

如果想配置其它格式的默认配置文件，那就需要在bootstrap.yml里面指明配置文件的默认后缀名。

![image-20220720134325227](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720134325227.png)

### 坑4：nacos配置持久化

![image-20220719212210635](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719212210635.png)

这一步可能会执行nacos-mysql.sql时报错，直接复制sql语句执行就好。

### 坑5：配置文件的dataid和bootstrap中的名字

是yaml，那两边都要写yaml，是yml，两边就都写yml，否则是无法找到配置文件的！

![image-20220731001205442](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731001205442.png)

## JSONView

修改完jsonview.css后要重新导入插件到chrome里面才会生效。

![image-20220719224205275](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719224205275.png)

![image-20220719224223601](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220719224223601.png)

## vue-cli脚手架

~~~shell
npm install -g vue-cli
~~~

~~~shell
vue init webpack appname 
~~~

## gateway

![image-20220720111333357](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720111333357.png)

## 跨域

![image-20220720111841974](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720111841974.png)

![image-20220720111929689](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720111929689.png)

![image-20220720111952727](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720111952727.png)

![image-20220720112616435](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720112616435.png)

## el-tree

![image-20220720113716706](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720113716706.png)

![image-20220720114052221](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720114052221.png)

![image-20220720114520542](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720114520542.png)

## renren-fast启动报错

![image-20220720134924161](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720134924161.png)

![image-20220720134939047](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720134939047.png)

![image-20220720134951404](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720134951404.png)

## yaml语法严格

![image-20220720151150547](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720151150547.png)

![image-20220720234408841](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720234408841.png)

## springcloudalibaba/springcloud/springboot版本对照

https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E

![image-20220720160857442](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720160857442.png)

![image-20220720201253514](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720201253514.png)

![image-20220720201738029](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720201738029.png)

![image-20220720201901548](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720201901548.png)

一般用spring Initializer脚手架搭建的spring项目一开始就会帮我们适配好我们选中的依赖版本，如果同时选了springcloudalibaba和

springcloud的组件的话，那么它就会帮我把三者的依赖版本都适配好，所以建议直接把脚手架的镜像地址改为https://start.aliyun.com/，这样的话，就可以同时选用阿里巴巴和springcloud的组件了，它也会帮我们适配好他们直接的版本，因为Https://start.spring.io/

这个官方镜像在初始化界面是没有alibaba的组件选择的，这就意味着我们在后续要自己添加阿里巴巴的pom依赖，那么这就可能会出现版本不适配的情况出现。

**同时用到springcloudalibaba和springcloud和springboot时，用脚手架来选中三者的依赖让脚手架帮我们适配三者的版本可以最大程度的避免版本不适配的问题。**

![image-20220720210556467](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720210556467.png)

![image-20220720203316107](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720203316107.png)

![image-20220720203602425](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720203602425.png)

## gateway-503

![image-20220720162659005](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720162659005.png)

![image-20220720162806977](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720162806977.png)

## gateway配置跨域

![image-20220720164220412](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720164220412.png)

~~~yaml
spring:
  cloud:
    gateway:
      globalcors:
        corsConfigurations:
          '[/**]':
            allowCredentials: true
            allowedHeaders: '*'
            allowedMethods: '*'
            allowedOrigins: '*'
~~~



或：

![image-20220720164235834](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720164235834.png)

~~~java
package net.youqu.micro.service.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.reactive.CorsWebFilter;
import org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource;
import org.springframework.web.util.pattern.PathPatternParser;

/**
 * description
 * from www.fhadmin.org
 */
@Configuration
public class CorsConfig implements WebFluxConfigurer{
    @Bean
    public CorsWebFilter corsFilter() {
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedMethod("*");
        config.addAllowedOrigin("*");
        config.addAllowedHeader("*");

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(new PathPatternParser());
        source.registerCorsConfiguration("/**", config);

        return new CorsWebFilter(source);
    }
}
~~~

## equals

![image-20220720183638302](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720183638302.png)

![image-20220720183923747](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720183923747.png)

## gateway路由yaml文件

~~~yaml
server:
  port: 8000
spring:
  cloud:
    gateway:
      globalcors:
        corsConfigurations:
          '[/**]':
            allowCredentials: true
            allowedOrigins: "*"
            allowedMethods: "*"
            allowedHeaders: "*"
      discovery:
        locator:
          enabled: true
      routes:
        - id: gulimall-order
          uri: lb://gulimall-order
          predicates:
            - Path=/api/renren-fast/order/**
          filters:
            - RewritePath=/api/renren-fast/?(?<segment>.*),/$\{segment}

        - id: gulimall-member
          uri: lb://gulimall-merber
          predicates:
            - Path=/api/renren-fast/merber/**
          filters:
            - RewritePath=/api/renren-fast/?(?<segment>.*),/$\{segment}

        - id: gulimall-product
          uri: lb://gulimall-product
          predicates:
            - Path=/api/renren-fast/product/**
          filters:
            - RewritePath=/api/renren-fast/?(?<segment>.*),/$\{segment}

        - id: gulimall-coupon
          uri: lb://gulimall-coupon
          predicates:
            - Path=/api/renren-fast/coupon/**
          filters:
            - RewritePath=/api/renren-fast/?(?<segment>.*),/$\{segment}

        - id: gulimall-ware
          uri: lb://gulimall-ware
          predicates:
            - Path=/api/renren-fast/ware/**
          filters:
            - RewritePath=/api/renren-fast/?(?<segment>.*),/$\{segment}
        #短的应该放后面，否则请求会先执行这个路由，而不会路由到各个服务了。
        - id: renren-fast
          uri: lb://renren-fast
          predicates:
            - Path=/api/renren-fast/**
          filters:
            - RewritePath=/api/?(?<segment>.*),/$\{segment}

        
~~~



## internal java compiler error

![image-20220720230319083](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720230319083.png)

![image-20220720230330252](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720230330252.png)

![image-20220720230341605](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720230341605.png)

![image-20220720230352797](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720230352797.png)

![image-20220720230407787](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720230407787.png)

## maven创建工程的坑

![image-20220720231308057](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720231308057.png)



![image-20220720234619729](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220720234619729.png)

![image-20220721000552176](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220721000552176.png)

## SpringCloud启动LN:170 Cannot determine local hostname

![image-20220721001702344](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220721001702344.png)

## nacos地址书写规则：

![image-20220721002046861](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220721002046861.png)

![image-20220721002319493](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220721002319493.png)

## JSR303

![image-20220722114037758](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220722114037758.png)

![image-20220722114921705](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220722114921705.png)

![image-20220722115018032](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220722115018032.png)

## 后端传输数据到前端（JSON）序列化问题

![image-20220730212509544](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220730212509544.png)

![image-20220730212520080](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220730212520080.png)

## 前端中表格插入

![image-20220730212749292](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220730212749292.png)

## 是method不是methods

![image-20220730220724900](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220730220724900.png)

## 版本仲裁

![image-20220730230513815](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220730230513815.png)

## springcloud-alibaba文档地址

https://spring-cloud-alibaba-group.github.io/github-pages/hoxton/zh-cn/index.html#_%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86

## oss key-secret

```excel
UserPrincipalName,AccessKeyId,AccessKeySecret
gulimall@1192944832747919.onaliyun.com,LTAI5tDF9cuTARH6BqMKqrML,mgoRK3Gkrg2RruoqBH6ehyMwb174Ni
```

![image-20220730233614823](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220730233614823.png)



## maven依赖顺序原则

maven依赖原则总结起来就两条：路径最短，申明顺序其次。

![image-20220731110808838](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731110808838.png)

![image-20220731111013500](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731111013500.png)

![image-20220731111024287](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731111024287.png)

![image-20220731111036509](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731111036509.png)

### bug分析

很明显，是matchesCharacter找不到。

~~~java
java.lang.NoSuchMethodError: org.springframework.util.StringUtils.matchesCharacter(Ljava/lang/String;C)Z
	at org.springframework.web.util.UrlPathHelper.getContextPath(UrlPathHelper.java:398) ~[spring-web-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.util.UrlPathHelper.getPathWithinApplication(UrlPathHelper.java:297) ~[spring-web-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.util.UrlPathHelper.getLookupPathForRequest(UrlPathHelper.java:186) ~[spring-web-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.getHandlerInternal(AbstractHandlerMethodMapping.java:363) ~[spring-webmvc-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:110) ~[spring-webmvc-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:59) ~[spring-webmvc-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.servlet.handler.AbstractHandlerMapping.getHandler(AbstractHandlerMapping.java:396) ~[spring-webmvc-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.servlet.DispatcherServlet.getHandler(DispatcherServlet.java:1234) ~[spring-webmvc-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1016) ~[spring-webmvc-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943) ~[spring-webmvc-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006) ~[spring-webmvc-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898) ~[spring-webmvc-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:626) ~[tomcat-embed-core-9.0.41.jar:4.0.FR]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883) ~[spring-webmvc-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:733) ~[tomcat-embed-core-9.0.41.jar:4.0.FR]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53) ~[tomcat-embed-websocket-9.0.41.jar:9.0.41]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.2.12.RELEASE.jar:5.2.12.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202) ~[tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:97) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:542) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:143) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:78) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:374) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:888) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1597) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [na:1.8.0_333]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [na:1.8.0_333]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) [tomcat-embed-core-9.0.41.jar:9.0.41]
	at java.lang.Thread.run(Thread.java:750) [na:1.8.0_333]
~~~

![image-20220731111755219](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731111755219.png)

![image-20220731111240443](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731111240443.png)

原因就是我们分别单独引入了oss和common的依赖，第三方服务的模块使用的web依赖来自于common里面的，但是spring-core却是在oss和common中都有且层级都一样，那么层级一样时就根据声明顺序来决定使用谁，谁先声明的就使用谁，这里我们先声明了oss的依赖，那么会使用oss的spring-core-5.2.1，但spring-core-5.2.1中并没有matchesCharacter这个方法，所以就直接报错了。

![image-20220731112446337](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731112446337.png)

### 1、当我们排除了oss里面的spring-boot-starter时（spring-core在其里面）：

![image-20220731112621612](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731112621612.png)

![image-20220731112701551](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731112701551.png)

就可以正常访问了，因为这个时候用的就是common里面的spring-core-5.2.12了。

### 2、或者，当我们把oss依赖声明在后面时：

![image-20220731112849139](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731112849139.png)

![image-20220731112923412](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731112923412.png)

也可以正常运行，因为层级相同时，优先使用先声明的依赖，这里common先声明的，所以直接使用的是common里面的spring-core-5.2.12。

### 3、最后一种方法：直接把oss放到common里面：

![image-20220731113558594](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731113558594.png)



![image-20220731113537585](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731113537585.png)

根据层级的就近优先原则，也会直接使用common里面的spring-core-5.2.12。

![image-20220731113900510](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731113900510.png)

## 取nacos配置中心里面的值

![image-20220731114854338](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731114854338.png)

![image-20220903213938582](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220903213938582.png)

## 前端oss上传回显异常

![image-20220731171450815](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731171450815.png)

![image-20220731171512814](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731171512814.png)

## el-form

![image-20220731172456526](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731172456526.png)

## elementui的样式问题

![image-20220731190730452](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731190730452.png)

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731191245758.png)

~~~xml
<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
~~~

~~~vue
<el-table-column
        prop="logo"
        header-align="center"
        align="center"
        label="品牌logo地址"
      >
        <template slot-scope="scope">
          <div  class="block">
            <el-image :src="scope.row.logo" style="height: 80px;width: 100px" fit="fill">
              <div slot="error" class="image-slot">
                <i class="el-icon-picture-outline"></i>
              </div>
            </el-image>
          </div>
        </template>
      </el-table-column>
~~~

## 使用mp的分页插件获取到的total一直为0

一般是没有配置mp的分页插件导致的：

![image-20220731204302446](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731204302446.png)

~~~java
package com.atguigu.common.mybatisplusconfig;

import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MybatisPlusConfig {
    /**
     * 分页插件
     */
    @Bean  //让Spring容器进行管理
    public PaginationInterceptor paginationInterceptor(){
        PaginationInterceptor page = new PaginationInterceptor();
        return page;
    }

}

~~~

![image-20220731204543713](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731204543713.png)

## postman如何在请求中带json数据

很多新手不知道**post**man如何发送json参数，今天我就给大家分享一下。 在地址栏里输入请求url：http://127.0.0.1:8081/getmoney 接着选择“POST”方式。 在“headers”添加key:Content-Type , value:application/json 然后点击"body",''raw''并设定为JSON。 最后点击send发送即可。

## JSR303

前端传来的数据会存在一个转换的步骤。

![image-20220731225524231](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731225524231.png)

~~~
空检查 
@Null 验证对象是否为null 
@NotNull 验证对象是否不为null, 无法查检长度为0的字符串 Accepts any type.
@NotBlank 检查约束字符串是不是Null还有被Trim的长度是否大于0,只对字符串,且会去掉前后空格. Accepts CharSequence 
@NotEmpty 检查约束元素是否为NULL或者是EMPTY. Accepts CharSequence/Collection/Map/Array

Booelan检查 
@AssertTrue 验证 Boolean 对象是否为 true 
@AssertFalse 验证 Boolean 对象是否为 false

长度检查 
@Size(min=, max=) 验证对象（Array,Collection,Map,String）长度是否在给定的范围之内 
@Length(min=, max=) Validates that the annotated string is between min and max included.

日期检查 
@Past 验证 Date 和 Calendar 对象是否在当前时间之前，验证成立的话被注释的元素一定是一个过去的日期 
@Future 验证 Date 和 Calendar 对象是否在当前时间之后 ，验证成立的话被注释的元素一定是一个将来的日期 
@Pattern 验证 String 对象是否符合正则表达式的规则，被注释的元素符合制定的正则表达式，regexp:正则表达式 flags: 指定 Pattern.Flag 的数组，表示正则表达式的相关选项。

数值检查 
建议使用在Stirng,Integer类型，不建议使用在int类型上，因为表单值为“”时无法转换为int，但可以转换为Stirng为”“,Integer为null 
@Min 验证 Number 和 String 对象是否大等于指定的值 
@Max 验证 Number 和 String 对象是否小等于指定的值 
@DecimalMax 被标注的值必须不大于约束中指定的最大值. 这个约束的参数是一个通过BigDecimal定义的最大值的字符串表示.小数存在精度 
@DecimalMin 被标注的值必须不小于约束中指定的最小值. 这个约束的参数是一个通过BigDecimal定义的最小值的字符串表示.小数存在精度 
@Digits 验证 Number 和 String 的构成是否合法 
@Digits(integer=,fraction=) 验证字符串是否是符合指定格式的数字，interger指定整数精度，fraction指定小数精度。 
@Range(min=, max=) 被指定的元素必须在合适的范围内 
@Range(min=10000,max=50000,message=”range.bean.wage”) 
@Valid 递归的对关联对象进行校验, 如果关联对象是个集合或者数组,那么对其中的元素进行递归校验,如果是一个map,则对其中的值部分进行校验.(是否进行递归验证) 
@CreditCardNumber信用卡验证 
@Email 验证是否是邮件地址，如果为null,不进行验证，算通过验证。 
@ScriptAssert(lang= ,script=, alias=) 
@URL(protocol=,host=, port=,regexp=, flags=)
~~~

![image-20220731230241015](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731230241015.png)

然后就可以看注释了：

![image-20220731230303988](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220731230303988.png)

### 自定义校验注解

![image-20220801131900826](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801131900826.png)

~~~java
/*注解本体
*/
package com.atguigu.gulimall.common.valid;

import javax.validation.Constraint;
import javax.validation.Payload;
import java.lang.annotation.Documented;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.*;
import static java.lang.annotation.ElementType.TYPE_USE;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Documented
@Constraint(validatedBy = {ListValuesConstraintValidator.class })//一个注解可以有多个检验器
@Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })
@Retention(RUNTIME)
public @interface ListValues {
    String message() default "{com.atguigu.gulimall.common.valid.ListValues.message}";//默认错误信息

    Class<?>[] groups() default { };

    Class<? extends Payload>[] payload() default { };
    int[] vals() default {};
}

~~~

~~~properties
com.atguigu.gulimall.common.valid.ListValues.message=必须提交指定值  #ValidationMessages.properties，为注解提供错误提示信息
~~~

~~~java
package com.atguigu.gulimall.common.valid;

import javax.validation.ConstraintValidator;
import javax.validation.ConstraintValidatorContext;
import java.util.HashSet;
import java.util.Set;

public class ListValuesConstraintValidator implements ConstraintValidator<ListValues,Integer> {
    private Set<Integer> set = new HashSet<>();
    @Override
    public boolean isValid(Integer value, ConstraintValidatorContext context) {
        return set.contains(value);
    }
    @Override
    public void initialize(ListValues constraintAnnotation) {

        int[] vals = constraintAnnotation.vals();

        for (int val : vals) {
            set.add(val);
        }

    }
}
/*对注解的处理的关联校验器。
~~~



## 未解决bug:（8.1已解决）

### 1声明在公共模块中的全局异常处理失效，但包扫描是已经配置好的。

放到自己的模块中就可以，放到公共模块却失效了。

![image-20220801164915277](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801164915277.png)

![image-20220801165146295](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801165146295.png)

![image-20220801165225329](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801165225329.png)

![image-20220801165447239](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801165447239.png)

直接把RRExceptionHandler删掉就ok了。

## 父子组件通信

![image-20220801224347026](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801224347026.png)

![image-20220801224545787](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801224545787.png)

![image-20220801225756779](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801225756779.png)

![image-20220801230048850](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801230048850.png)

![image-20220801230134592](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801230134592.png)

![image-20220801230158347](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220801230158347.png)

## 人人后台登录界面控制台报访问sys/menu跨域错误

bug:在后端服务器网关已经配置了允许跨域访问并且也删除了人人后台模块里面自带的跨域配置类的情况下（保证全局只有一个跨域配置），在访问人人后台登录时仍然会报错：Access to XMLHttpRequest at 'http://localhost:8000/api/renren-fast/sys/menu/nav?t=1659409509905' from origin 'http://localhost:9000' has been blocked by CORS policy: The 'Access-Control-Allow-Origin' header contains multiple values 'http://localhost:9000, http://localhost:9000', but only one is allowed.

![image-20220802110616332](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802110616332.png)

虽然不影响使用，但是还是看着很膈应。

于是就想办法解决：

我们直接在项目中搜索访问的地址后缀/sys/menu/nav,发现在路由的index文件中发送了这个请求：

![image-20220802105430070](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802105430070.png)

![image-20220802110406703](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802110406703.png)

![image-20220802114945073](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802114945073.png)

![image-20220802115100267](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802115100267.png)

![image-20220802115603895](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802115603895.png)



![image-20220802110454698](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802110454698.png)

http://localhost:8000/api/renren-fast/sys/menu/nav?t=1659409509905

t=1659409509905就是默认参数

就是这里还没有登录就发送了这个请求导致报错，应该是被后台shiro拦截了（我猜测，因为我没用过shiro，因为我后端只在网关配置了跨域，人人自带的跨域CrosConfig类也删了，所以全局理论就只有一个跨域配置了）,有知道的大佬可以帮忙解释一下，谢谢。

不过，这并不影响问题的解决，既然是登录时就发送了请求被拒绝了，那么我们就让它登录之后获取到token后再发送嘛：

![image-20220802111717784](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802111717784.png)

![image-20220802111832358](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802111832358.png)

![image-20220802111938554](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802111938554.png)

当然，这个默认参数t其实并没有什么用，可以关闭

![image-20220802112103985](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802112103985.png)

![image-20220802112217901](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802112217901.png)

## @JsonInclude(JsonInclude.Include.NON_EMPTY)

![image-20220802140454294](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802140454294.png)

![image-20220802140606023](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802140606023.png)

## idea里面的注释

单行：ctrl+/

多行：ctrl+shift+/

## String并没有重写toString方法

![image-20220802184212182](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802184212182.png)

## 大数据下不建议连表查询

![image-20220802220515877](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220802220515877.png)

~~~java
 public PageUtils queryBaseAttrPage(Map<String, Object> params, String cateLogId) {
        QueryWrapper<AttrEntity> queryWrapper = new QueryWrapper<>();
        IPage<AttrEntity> page = this.page(
                new Query<AttrEntity>().getPage(params),
            	new QueryWrapper<AttrEntity>().eq(!cateLogId.equals("0"),"catelog_id",cateLogId).like(!StringUtils.isEmpty(params.get("key")),"attr_name",params.get("key")).or().like(!StringUtils.isEmpty(params.get("key")),"attr_id",params.get("key"))
        );
        PageUtils pageUtils = new PageUtils(page);
        List<AttrRespVo> respVos = page.getRecords().stream().map(attr -> {
            AttrRespVo attrRespVo = new AttrRespVo();
            BeanUtils.copyProperties(attr, attrRespVo);
            AttrAttrgroupRelationEntity relationEntity = attrAttrgroupRelationService.getOne(new QueryWrapper<AttrAttrgroupRelationEntity>().eq("attr_id", attr.getAttrId()));
            if (relationEntity != null) {
                Long attrGroupId = relationEntity.getAttrGroupId();
                AttrGroupEntity attrGroupEntity = attrGroupDao.selectById(attrGroupId);
                attrRespVo.setGroupName(attrGroupEntity.getAttrGroupName());
            }
            CategoryEntity categoryEntity = categoryDao.selectById(attr.getCatelogId());
            if (categoryEntity != null) {
                attrRespVo.setCatelogName(categoryEntity.getName());
            }
            return attrRespVo;
        }).collect(Collectors.toList());
        pageUtils.setList(respVos);
        return pageUtils;
~~~

## 查询属性分组未关联的属性

要求是属于当前属性分组的分类下的属性，且不包括已经被自己关联的属性和被当前分类下其它分组关联的属性。

![image-20220803225842189](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220803225842189.png)

![image-20220803230758162](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220803230758162.png)



~~~java
public PageUtils queryNoRelationAttr(String attrgroupId, Map<String, Object> params) {
        AttrGroupEntity attrGroupEntity = this.getById(attrgroupId);
        Long catelogId = attrGroupEntity.getCatelogId();
        List<AttrGroupEntity> otherAttrGroupList = this.list(new QueryWrapper<AttrGroupEntity>().eq("catelog_id", catelogId));
        List<Long> usedAttrIds = new ArrayList<>();
        if (otherAttrGroupList.size()>0){
            otherAttrGroupList.stream().map((item) -> {
                List<AttrAttrgroupRelationEntity> list = attrAttrgroupRelationService.list(new QueryWrapper<AttrAttrgroupRelationEntity>().eq("attr_group_id", item.getAttrGroupId()));
                list.forEach(attrAttrgroupRelationEntity -> {
                    usedAttrIds.add(attrAttrgroupRelationEntity.getAttrId());
                });
                return null;
            }).collect(Collectors.toList());
        }
        IPage<AttrEntity> page = attrService.page(new Query<AttrEntity>().getPage(params), new QueryWrapper<AttrEntity>().eq("catelog_id", catelogId).notIn(usedAttrIds.size() > 0, "attr_id", usedAttrIds).eq(!StringUtils.isEmpty(params.get("key")), "attr_id", params.get("key")).or().like(!StringUtils.isEmpty(params.get("key")), "attr_name", params.get("key")));
        return new PageUtils(page);
    }
~~~

![image-20220803230106092](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220803230106092.png)

## 接口文档地址

https://easydoc.net/doc/75716633/ZUqEdvA4/VhgnaedC

## 引入openfeign的坑

![image-20220804201555948](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220804201555948.png)

![image-20220804201711918](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220804201711918.png)

报错缺失的类就在spring-boot-starter-web:2.3.7.RELEASE里面有，且这个包我们已经在项目中引入了的，所以只有一个可能，那就是因为openfeign的starter引入的太早了，先进行了自动装配，但是此时web还没有自动装配，所以报错了。

所以依赖在pom文件的引入先后是有顺序的。应该先引入web的场景启动器，再引入依赖了web的其它场景启动器。

![image-20220804202239860](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220804202239860.png)

##  npm install --save pubsub-js

![image-20220804221910561](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220804221910561.png)

## renren-fast-vue项目部署后npm无法使用

![image-20220804223748240](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220804223748240.png)

https://nodejs.org/zh-cn/download/releases/对照表

![image-20220804223950428](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220804223950428.png)

npm install node-sass报错问题的解决

![image-20220804224159621](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220804224159621.png)

![image-20220804224233561](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220804224233561.png)

![image-20220804224319029](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220804224319029.png)

## this.$还是this.取决于你如何设置原型对象的属性

![image-20220806162453393](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220806162453393.png)

![image-20220806162519070](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220806162519070.png)

![image-20220806162539886](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220806162539886.png)

## centos设置静态ip

VM和CentOS7安装参考: VM15安装、CentOS7安装

当我们安装好CentOS7后, 要分配一个ip给系统, 进入root权限, 使用dhclient动态分配一个ip地址给linux系统; 但是这样只是动态的分配一个, 下次启动后该ip就不可用了, 此时就需要将这个ip静态设置该这个系统;

设置静态ip, 首先进入vi /etc/sysconfig/network-scripts/ifcfg-ens33 编辑该文件, 修改为如下:

~~~vim
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens33
UUID=046cbff7-5153-4d7e-b10f-d872c098260e
DEVICE=ens33
ONBOOT=yes
IPADDR=192.168.61.132
NETMASK=255.255.255.0
GATEWAY=192.168.61.2
DNS1=119.29.29.29
DNS2=202.96.128.166
PEERROUTES=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
~~~

![image-20220806175542605](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220806175542605.png)

## 可以用map接收请求体以及请求参数

但不建议，因为不易维护啊

![image-20220806215113861](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220806215113861.png)

## 发布商品功能

![image-20220806224037790](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220806224037790.png)

## feign客户端里面的方法参数和远程调用的参数可以不是同一个TO

![image-20220806235553642](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220806235553642.png)

## 商品添加前端bug

如何解决添加完一个商品之后，回到第一步重新添加时，页面中仍然显示上一个商品中的数据：

![image-20220808132501468](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808132501468.png)

~~~javascript
resetSpuData() {
      this.spu = {
        catlogPath: [],
        spuName: "",
        spuDescription: "",
        catalogId: 0,
        brandId: "",
        weight: "",
        publishStatus: 0,
        decript: [],
        images: [],
        bounds: {
          buyBounds: 0,
          growBounds: 0
        },
        baseAttrs: [],
        skus: []
      };
      this.dataResp={
        //后台返回的所有数据
        attrGroups: [],
        baseAttrs: [],
        saleAttrs: [],
        tempSaleAttrs: [],
        tableAttrColumn: [],
        memberLevels: [],
        steped: [false, false, false, false, false]
      }
    }
~~~

注意，不仅要重置spu的数据，还要重置dataResp中的数据，否则会在后面的步骤中仍然包含上一个添加商品的数据

![image-20220808132641290](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808132641290.png)

并且，为了让这里也置空，我们做如下操作。

![image-20220808132753351](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808132753351.png)

![image-20220808132917271](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808132917271.png)

![image-20220808133031582](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808133031582.png)

![image-20220808133315057](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808133315057.png)

![image-20220808133500388](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808133500388.png)

![image-20220808134023213](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808134023213.png)

![image-20220808134237213](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808134237213.png)

![image-20220808191439405](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808191439405.png)

## Field ‘spu_id‘ doesn‘t have a default valu 解决办法

![image-20220808180443380](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808180443380.png)

![image-20220808180451197](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808180451197.png)

## 商品保存类业务的注意点：

![image-20220808180930844](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220808180930844.png)

~~~java
@Transactional
    @Override
    public void saveSpu(SpuSaveVo spuInfo) {
        //1、保存spu基本信息：pms_spu_info
        SpuInfoEntity spuInfoEntity = new SpuInfoEntity();
        BeanUtils.copyProperties(spuInfo,spuInfoEntity);
        this.save(spuInfoEntity);
        //2、保存spu的描述图片：pms_spu_info_desc
        SpuInfoDescEntity spuInfoDescEntity = new SpuInfoDescEntity();
        List<String> desc = spuInfo.getDecript();
        String join = String.join(",", desc);
        spuInfoDescEntity.setSpuId(spuInfoEntity.getId());
        spuInfoDescEntity.setDecript(join);
        spuInfoDescService.save(spuInfoDescEntity);

        //3、保存spu的图片集：pms_spu_images
        List<String> images = spuInfo.getImages();
        if (images!=null&&images.size()>0){
            List<SpuImagesEntity> collect = images.stream().map(item -> {
                SpuImagesEntity spuImagesEntity = new SpuImagesEntity();
                spuImagesEntity.setSpuId(spuInfoEntity.getId());
                spuImagesEntity.setImgUrl(item);
                return spuImagesEntity;
            }).collect(Collectors.toList());
            spuImagesService.saveBatch(collect);
        }

        //4、保存spu的规格参数：pms_product_attr_value
        List<BaseAttrs> baseAttrs = spuInfo.getBaseAttrs();
        if (baseAttrs!=null && baseAttrs.size()>0){
            List<ProductAttrValueEntity> attrValueEntities = baseAttrs.stream().map(item -> {
                ProductAttrValueEntity productAttrValueEntity = new ProductAttrValueEntity();
                productAttrValueEntity.setSpuId(spuInfoEntity.getId());
                productAttrValueEntity.setAttrId(item.getAttrId());
                productAttrValueEntity.setAttrValue(item.getAttrValues());
                AttrEntity attrEntity = attrService.getById(item.getAttrId());
                productAttrValueEntity.setAttrName(attrEntity.getAttrName());
                productAttrValueEntity.setQuickShow(item.getShowDesc());
                return productAttrValueEntity;
            }).collect(Collectors.toList());
            productAttrValueService.saveBatch(attrValueEntities);
        }

        //5、保存spu的积分信息：gulimall_sms--->sms_spu_bounds
        Bounds bounds = spuInfo.getBounds();
        SpuBoundTo spuBoundTo = new SpuBoundTo();
        BeanUtils.copyProperties(bounds,spuBoundTo);
        spuBoundTo.setSpuId(spuInfoEntity.getId());
        couponFeignClient.save(spuBoundTo);

        //6、保存当前spu对应的所有sku信息：pms_sku_info
        //6、1）、sku的基本信息:pms_sku_info
        List<Skus> skus = spuInfo.getSkus();
        if (skus!=null&&skus.size()>0){
            skus.forEach(sku->{
                String defaultImg="";
                for (Images img:sku.getImages()) {
                    if (img.getDefaultImg() == 1){
                        defaultImg = img.getImgUrl();
                    }
                }
                SkuInfoEntity skuInfoEntity = new SkuInfoEntity();
                BeanUtils.copyProperties(sku,skuInfoEntity);
                skuInfoEntity.setBrandId(spuInfoEntity.getBrandId());
                skuInfoEntity.setCatalogId(spuInfoEntity.getCatalogId());
                skuInfoEntity.setSkuDefaultImg(defaultImg);
                skuInfoEntity.setSaleCount(0L);
                skuInfoEntity.setSpuId(spuInfoEntity.getId());
                skuInfoService.save(skuInfoEntity);
                Long skuId = skuInfoEntity.getSkuId();
                if (sku.getImages()!=null&&sku.getImages().size()>0){
                    List<SkuImagesEntity> skuImagesEntities = sku.getImages().stream().map(img -> {
                        SkuImagesEntity skuImagesEntity = new SkuImagesEntity();
                        skuImagesEntity.setSkuId(skuId);
                        skuImagesEntity.setImgUrl(img.getImgUrl());
                        skuImagesEntity.setDefaultImg(img.getDefaultImg());
                        return skuImagesEntity;
                    }).filter(item -> {
                        return !StringUtils.isEmpty(item.getImgUrl());
                    }).collect(Collectors.toList());
                    if (skuImagesEntities!=null&&skuImagesEntities.size()>0){
                        //6、2）、sku的图片信息：pms_sku_images
                        skuImagesService.saveBatch(skuImagesEntities);
                    }
                }
                //6、3）、sku的销售属性：pms_sku_sale_attr_value
                List<Attr> attrs = sku.getAttr();
                if (attrs!=null&&attrs.size()>0){
                    List<SkuSaleAttrValueEntity> skuSaleAttrValueEntities = attrs.stream().map(attr -> {
                        SkuSaleAttrValueEntity skuSaleAttrValueEntity = new SkuSaleAttrValueEntity();
                        skuSaleAttrValueEntity.setSkuId(skuId);
                        BeanUtils.copyProperties(attr, skuSaleAttrValueEntity);
                        return skuSaleAttrValueEntity;
                    }).collect(Collectors.toList());
                    if (skuSaleAttrValueEntities.size()>0){
                        skuSaleAttrValueService.saveBatch(skuSaleAttrValueEntities);
                    }
                }
                //6、4）、sku的优惠、满减等信息：gulimall_sms--->sms_sku_ladder、sms_sku_full_reduction、sms_member_price
                SkuReductionTo skuReductionTo = new SkuReductionTo();
                BeanUtils.copyProperties(sku,skuReductionTo);
                System.out.println(skuReductionTo);
                skuReductionTo.setSkuId(skuId);
                if (skuReductionTo.getFullCount()>0&&skuReductionTo.getFullPrice().compareTo(BigDecimal.ZERO)==1){
                    couponFeignClient.saveInfo(skuReductionTo);
                }
            });
        }
    }
~~~



![image-20220809145103907](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220809145103907.png)

## 修改spu规格参数路由跳转404

![image-20220809211628025](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220809211628025.png)

点规格，404，前端改一下：
/src/router/index.js 在mainRoutes->children里面加上：{ path: ’/product-attrupdate’, component: _import(‘modules/product/attrupdate’), name: ‘attr-update’, meta: { title: ‘规格维护’, isTab: true } }
![image-20220809211724014](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220809211724014.png)

## 人人前端动态产生路由，代码很精髓啊

~~~js
/**
 * 全站路由配置
 *
 * 建议:
 * 1. 代码中路由统一使用name属性跳转(不使用path属性)
 */
import Vue from 'vue'
import Router from 'vue-router'
import http from '@/utils/httpRequest'
import { isURL } from '@/utils/validate'
import { clearLoginInfo } from '@/utils'


Vue.use(Router)

// 开发环境不使用懒加载, 因为懒加载页面太多的话会造成webpack热更新太慢, 所以只有生产环境使用懒加载
const _import = require('./import-' + process.env.NODE_ENV)

// 全局路由(无需嵌套上左右整体布局)
const globalRoutes = [
  { path: '/404', component: _import('common/404'), name: '404', meta: { title: '404未找到' } },
  { path: '/login', component: _import('common/login'), name: 'login', meta: { title: '登录' } }
]

// 主入口路由(需嵌套上左右整体布局)
const mainRoutes = {
  path: '/',
  component: _import('main'),
  name: 'main',
  redirect: { name: 'home' },
  meta: { title: '主入口整体布局' },
  children: [
    // 通过meta对象设置路由展示方式
    // 1. isTab: 是否通过tab展示内容, true: 是, false: 否
    // 2. iframeUrl: 是否通过iframe嵌套展示内容, '以http[s]://开头': 是, '': 否
    // 提示: 如需要通过iframe嵌套展示内容, 但不通过tab打开, 请自行创建组件使用iframe处理!
    { path: '/home', component: _import('common/home'), name: 'home', meta: { title: '首页' } },
    { path: '/theme', component: _import('common/theme'), name: 'theme', meta: { title: '主题' } },
    { path: '/demo-echarts', component: _import('demo/echarts'), name: 'demo-echarts', meta: { title: 'demo-echarts', isTab: true } },
    { path: '/demo-ueditor', component: _import('demo/ueditor'), name: 'demo-ueditor', meta: { title: 'demo-ueditor', isTab: true } },
    { path: '/product-attrupdate', component: _import('modules/product/attrupdate'), name: 'attr-update', meta: { title: '规格维护', isTab: true } }
  ],
  beforeEnter (to, from, next) {
    let token = Vue.cookie.get('token')
    if (!token || !/\S/.test(token)) {
      clearLoginInfo()
      next({ name: 'login' })
    }
    next()
  }
}

const router = new Router({
  mode: 'hash',
  scrollBehavior: () => ({ y: 0 }),
  isAddDynamicMenuRoutes: false, // 是否已经添加动态(菜单)路由
  routes: globalRoutes.concat(mainRoutes)
})

router.beforeEach((to, from, next) => {
  // 添加动态(菜单)路由
  // 1. 已经添加 or 全局路由, 直接访问
  // 2. 获取菜单列表, 添加并保存本地存储
  if (router.options.isAddDynamicMenuRoutes || fnCurrentRouteType(to, globalRoutes) === 'global') {
    next()
  } else {
    router.push({ name: 'login' })
    if (Vue.cookie.get("token")){
      http({
        url: http.adornUrl('/sys/menu/nav'),
        method: 'get',
        params: http.adornParams()
      }).then(({data}) => {
        if (data && data.code === 0) {
          fnAddDynamicMenuRoutes(data.menuList)
          router.options.isAddDynamicMenuRoutes = true
          sessionStorage.setItem('menuList', JSON.stringify(data.menuList || '[]'))
          sessionStorage.setItem('permissions', JSON.stringify(data.permissions || '[]'))
          next({ ...to, replace: true })
        } else {
          sessionStorage.setItem('menuList', '[]')
          sessionStorage.setItem('permissions', '[]')
          next()
        }
      }).catch((e) => {
        console.log(`%c${e} 请求菜单列表和权限失败，跳转至登录页！！`, 'color:blue')
      })
    }
    }

})

/**
 * 判断当前路由类型, global: 全局路由, main: 主入口路由
 * @param {*} route 当前路由
 */
function fnCurrentRouteType (route, globalRoutes = []) {
  var temp = []
  for (var i = 0; i < globalRoutes.length; i++) {
    if (route.path === globalRoutes[i].path) {
      return 'global'
    } else if (globalRoutes[i].children && globalRoutes[i].children.length >= 1) {
      temp = temp.concat(globalRoutes[i].children)
    }
  }
  return temp.length >= 1 ? fnCurrentRouteType(route, temp) : 'main'
}

/**
 * 添加动态(菜单)路由
 * @param {*} menuList 菜单列表
 * @param {*} routes 递归创建的动态(菜单)路由
 */
function fnAddDynamicMenuRoutes (menuList = [], routes = []) {
  var temp = []
  for (var i = 0; i < menuList.length; i++) {
    if (menuList[i].list && menuList[i].list.length >= 1) {
      temp = temp.concat(menuList[i].list)
    } else if (menuList[i].url && /\S/.test(menuList[i].url)) {
      menuList[i].url = menuList[i].url.replace(/^\//, '')
      var route = {
        path: menuList[i].url.replace('/', '-'),
        component: null,
        name: menuList[i].url.replace('/', '-'),
        meta: {
          menuId: menuList[i].menuId,
          title: menuList[i].name,
          isDynamic: true,
          isTab: true,
          iframeUrl: ''
        }
      }
      // url以http[s]://开头, 通过iframe展示
      if (isURL(menuList[i].url)) {
        route['path'] = `i-${menuList[i].menuId}`
        route['name'] = `i-${menuList[i].menuId}`
        route['meta']['iframeUrl'] = menuList[i].url
      } else {
        try {
          route['component'] = _import(`modules/${menuList[i].url}`) || null
        } catch (e) {}
      }
      routes.push(route)
    }
  }
  if (temp.length >= 1) {
    fnAddDynamicMenuRoutes(temp, routes)
  } else {
    mainRoutes.name = 'main-dynamic'
    mainRoutes.children = routes
    router.addRoutes([
      mainRoutes,
      { path: '*', redirect: { name: '404' } }
    ])
    sessionStorage.setItem('dynamicMenuRoutes', JSON.stringify(mainRoutes.children || '[]'))
    console.log('\n')
    console.log('%c!<-------------------- 动态(菜单)路由 s -------------------->', 'color:blue')
    console.log(mainRoutes.children)
    console.log('%c!<-------------------- 动态(菜单)路由 e -------------------->', 'color:blue')
  }
}

export default router
~~~

## 关于spu规格维护的bug

![image-20220810134657528](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220810134657528.png)

![image-20220810141239645](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220810141239645.png)

![image-20220810141323282](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220810141323282.png)

![image-20220810141752949](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220810141752949.png)

解决方案：

![image-20220810142502552](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220810142502552.png)

![image-20220810142717399](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220810142717399.png)

![image-20220810142839818](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220810142839818.png)

![image-20220810142928589](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220810142928589.png)

## 前端Uncaught (in promise) cancel

![image-20220810175445035](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220810175445035.png)

![image-20220810175614289](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220810175614289.png)

## feign客户端接口最好加上参数注解

![image-20220812075255631](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220812075255631.png)

## 安装elastic search

 dokcer中安装elastic search

（1）下载ealastic search和kibana

```shell
docker pull elasticsearch:7.6.2
docker pull kibana:7.6.2
```

（2）配置

```shell
mkdir -p /mydata/elasticsearch/config  创建目录
mkdir -p /mydata/elasticsearch/data
echo "http.host: 0.0.0.0" >/mydata/elasticsearch/config/elasticsearch.yml

//将mydata/elasticsearch/文件夹中文件都可读可写
chmod -R 777 /mydata/elasticsearch/
```



（3）启动Elastic search

centos7一定不要忘了加--privileged=true

```shell
docker run --name elasticsearch --privileged=true -p 9200:9200 -p 9300:9300 \
-e  "discovery.type=single-node" \
-e ES_JAVA_OPTS="-Xms64m -Xmx512m" \
-v /mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml \
-v /mydata/elasticsearch/data:/usr/share/elasticsearch/data \
-v  /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins \
-d elasticsearch:7.6.2 
```

设置开机启动elasticsearch

```shell
docker update elasticsearch --restart=always
```



（4）启动kibana：

```shell
docker run --name kibana -d -p 5601:5601 --link elasticsearch -e "ELASTICSEARCH_URL=http://192.168.61.132:9200" kibana:7.6.2

```

设置开机启动kibana

```shell
docker update kibana  --restart=always
```





（5）测试

查看elasticsearch版本信息： http://192.168.61.132:9200/ 

```json
{
    "name": "0adeb7852e00",
    "cluster_name": "elasticsearch",
    "cluster_uuid": "9gglpP0HTfyOTRAaSe2rIg",
    "version": {
        "number": "7.6.2",
        "build_flavor": "default",
        "build_type": "docker",
        "build_hash": "ef48eb35cf30adf4db14086e8aabd07ef6fb113f",
        "build_date": "2020-03-26T06:34:37.794943Z",
        "build_snapshot": false,
        "lucene_version": "8.4.0",
        "minimum_wire_compatibility_version": "6.8.0",
        "minimum_index_compatibility_version": "6.0.0-beta1"
    },
    "tagline": "You Know, for Search"
}
```



显示elasticsearch 节点信息http://192.168.61.132:9200/_cat/nodes ，

```json
127.0.0.1 76 95 1 0.26 1.40 1.22 dilm * 0adeb7852e00
```



访问Kibana： http://192.168.61.132:5601/app/kibana 

![image-20200501192629304](D:/java/guli_mall/谷粒商城/Guli Mall(包含代码、课件、sql)/Guli Mall/文档/三阶段大纲md/images/image-20200501192629304.png)

## es的restful风格操纵数据

![image-20220813214814081](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220813214814081.png)

index是随机id的不指定,create是指定id的

index操作会覆盖文档，而create操作则不会。

## es测试数据地址

https://gitee.com/xlh_blog/common_content/blob/master/es%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE.json#

## es检索

### 1）search Api

ES支持两种基本方式检索；

* 通过REST request uri 发送搜索参数 （uri +检索参数）；
* 通过REST request body 来发送它们（uri+请求体）；

![image-20220813220711506](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220813220711506.png)

![image-20220813221955914](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220813221955914.png)

![image-20220813232255662](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220813232255662.png)

![image-20220814083642411](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814083642411.png)

![image-20220814084028854](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814084028854.png)

![image-20220814084428768](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814084428768.png)

![image-20220814085203007](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814085203007.png)

![image-20220814085534108](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814085534108.png)

![image-20220814085636946](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814085636946.png)

![image-20220814090145594](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814090145594.png)

![image-20220814091233376](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814091233376.png)

![image-20220814091456311](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814091456311.png)

![image-20220814092150061](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814092150061.png)

![image-20220814094425560](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814094425560.png)

![image-20220814094842490](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814094842490.png)

![image-20220814095254729](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814095254729.png)

![image-20220814095738113](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814095738113.png)

![image-20220814163316513](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814163316513.png)

### 2）数据迁移

先创建new_twitter的正确映射。然后使用如下方式进行数据迁移。

```json
POST reindex [固定写法]
{
  "source":{
      "index":"twitter"
   },
  "dest":{
      "index":"new_twitters"
   }
}
```



将旧索引的type下的数据进行迁移

```json
POST reindex [固定写法]
{
  "source":{
      "index":"twitter",
      "twitter":"twitter"
   },
  "dest":{
      "index":"new_twitters"
   }
}
```

更多详情见： https://www.elastic.co/guide/en/elasticsearch/reference/7.6/docs-reindex.html 

### 3）自定义词库

* 修改/usr/share/elasticsearch/plugins/ik/config中的IKAnalyzer.cfg.xml
  /usr/share/elasticsearch/plugins/ik/config

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<comment>IK Analyzer 扩展配置</comment>
	<!--用户可以在这里配置自己的扩展字典 -->
	<entry key="ext_dict"></entry>
	 <!--用户可以在这里配置自己的扩展停止词字典-->
	<entry key="ext_stopwords"></entry>
	<!--用户可以在这里配置远程扩展字典 -->
	<entry key="remote_ext_dict">http://192.168.61.132/es/fenci.txt</entry> 
	<!--用户可以在这里配置远程扩展停止词字典-->
	<!-- <entry key="remote_ext_stopwords">words_location</entry> -->
</properties>
```

原来的xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<comment>IK Analyzer 扩展配置</comment>
	<!--用户可以在这里配置自己的扩展字典 -->
	<entry key="ext_dict"></entry>
	 <!--用户可以在这里配置自己的扩展停止词字典-->
	<entry key="ext_stopwords"></entry>
	<!--用户可以在这里配置远程扩展字典 -->
	<!-- <entry key="remote_ext_dict">words_location</entry> -->
	<!--用户可以在这里配置远程扩展停止词字典-->
	<!-- <entry key="remote_ext_stopwords">words_location</entry> -->
</properties>

```

修改完成后，需要重启elasticsearch容器，否则修改不生效。

更新完成后，es只会对于新增的数据用更新分词。历史数据是不会重新分词的。如果想要历史数据重新分词，需要执行：

```shell
POST my_index/_update_by_query?conflicts=proceed
```





http://192.168.6.128/es/fenci.txt，这个是nginx上资源的访问路径

在运行下面实例之前，需要安装nginx（安装方法见安装nginx），然后创建“fenci.txt”文件，内容如下：

```shell
echo "樱桃萨其马，带你甜蜜入夏" > /mydata/nginx/html/fenci.txt 
```

## 打包插件

![image-20220814232834695](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814232834695.png)

![image-20220814232939748](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814232939748.png)

![image-20220814233112405](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220814233112405.png)

## springboot整合es

bootstrap.yml

~~~yml
spring:
  elasticsearch:
    rest:
      uris: http://192.168.61.132:9200
  application:
    name: gulimall-elasticsearch
  cloud:
    inetutils:
      ignored-interfaces: 'VMware Virtual Ethernet Adapter for VMnet1,VMware Virtual Ethernet Adapter for VMnet8'
    nacos:
      discovery:
        server-addr: localhost:8848
server:
  port: 8008
~~~

~~~xml
  <dependency>
            <groupId>org.elasticsearch.client</groupId>
            <artifactId>elasticsearch-rest-high-level-client</artifactId>
            <version>7.6.2</version>
        </dependency>
~~~

## 防止es出现扁平化错误

对于内部的对象使用type:nested

![image-20220815102640226](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220815102640226.png)

![image-20220815102808887](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220815102808887.png)

## 检索和查询

例：不能从搜索框找某个图片（检索），但是查找华为的时候会有华为的图片（查询）

~~~json
PUT product
{
  "mappings":{
    "properties":{
      "skuId":{
        "type":"long"
      },
      "spuId":{
        "type":"keyword"
      },
      "skuTitle":{
        "type": "text",
        "analyzer": "ik_smart"
      },
      "skuPrice":{
        "type": "keyword"
      },
      "skuImg":{
        "type": "keyword",
        "index": false, //不支持检索
        "doc_values": false//不支持聚合
      },
      "saleCount":{
        "type": "long"
      },
      "hasStock":{
        "type":"boolean"
      },
      "hotScore":{
        "type": "long"
      },
      "brandId":{
        "type": "long"
      },
      "brandName":{
        "type": "keyword",
        "index":false,
        "doc_values": false
      },
      "brandImg":{
        "type": "keyword",
        "index": false,
        "doc_values": false
      },
      "catelogName":{
        "type": "keyword", 
        "index": false,
        "doc_values": false
      },
      "attrs":{
        "type": "nested",
        "properties": {
          "attrId":{
            "type":"long"
          },
          "attrName":{
            "type":"keyword",
            "index":false,
            "doc_value":false
          },
          "attrValue":{
            "type":"keyword"
          }
        }
      }
    }
  }
}
~~~

## es里面text和keyword的区别

ElasticSearch 5.0以后，string类型有重大变更，移除了string类型，string字段被拆分成两种新的数据类型: text用于全文搜索的,而keyword用于关键词搜索。

ElasticSearch字符串将默认被同时映射成text和keyword类型，将会自动创建下面的动态映射(dynamic mappings):

~~~json
{
    "foo": {
        "type": "text",
        "fields": {
            "keyword": {
                "type": "keyword",
                "ignore_above": 256
            }
        }
    }
}
~~~

这就是造成部分字段还会自动生成一个与之对应的“.keyword”字段的原因。

**Text：**
 会分词，然后进行索引
 支持模糊、精确查询
 不支持聚合
 **keyword：**
 不进行分词，直接索引
 支持模糊、精确查询
 支持聚合

## 如何将Object转换为指定的类对象

~~~java
R r = wareFeignClient.getSkuHasStock(skuIds);
List<WareHasStockTo> data = r.getData(new TypeReference<List<WareHasStockTo>>() {
});
stockMap = data.stream().collect(Collectors.toMap(WareHasStockTo::getSkuId, item -> item.getHasStock()));
~~~

```java
public<T> T getData(TypeReference<T> typeReference){
		Object data = get("data");
		String s = JSON.toJSONString(data);
		T t = JSON.parseObject(s, typeReference);
		return t;
	}
```

## thymeleaf

![image-20220816151835691](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220816151835691.png)

## 关于maven公共模块与其它模块间依赖的引入

![image-20220816154721931](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220816154721931.png)

每次要重新package时，先install一下公共模块。

最好不要将某个特定模块中使用的依赖放到公共模块，防止其它模块打包时依赖冗余。

## 正向代理和反向代理

![image-20220816182730722](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220816182730722.png)

## nginx配置文件

nginx配置文件里面的每一行记得加分号！！！

![image-20220816184921708](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220816184921708.png)

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817090005542.png)

![image-20220817110121108](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817110121108.png)



## 前台检索页json数据模型

![image-20220816210705167](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220816210705167.png)

## 获取前端json数据的接口业务代码

~~~java
public Map<String, List<Catelog2Vo>> getIndexJsonData() {
        List<CategoryEntity> totalList = this.list();
        List<CategoryEntity> list = this.list(new QueryWrapper<CategoryEntity>().eq("parent_cid", 0).select("cat_id"));
        Map<String, List<Catelog2Vo>> map = list.stream().collect(Collectors.toMap(k -> k.getCatId().toString(), v -> {//一开始就应该用map直接收集，指定key和value。
            AtomicReference<Integer> indexForCate2 = new AtomicReference<>(1);
            AtomicReference<Integer> indexForCate3 = new AtomicReference<>(1);
            List<Catelog2Vo> catelog2VoList = totalList.stream().filter(cate -> {
                return cate.getParentCid().equals(v.getCatId());
            }).map((forCate2) -> {
                Catelog2Vo catelog2Vo = new Catelog2Vo();
                catelog2Vo.setCatelog1Id(v.getCatId().toString());
                catelog2Vo.setId(indexForCate2.toString());
                indexForCate2.getAndSet(indexForCate2.get() + 1);
                catelog2Vo.setName(forCate2.getName());
                List<Catelog2Vo.Catelog3Vo> catelog3VoList = totalList.stream().filter(cate -> {
                    return cate.getParentCid().equals(forCate2.getCatId());
                }).map(forCate3 -> {
                    Catelog2Vo.Catelog3Vo catelog3Vo = new Catelog2Vo.Catelog3Vo();
                    catelog3Vo.setCatelog2Id(forCate2.getCatId().toString());
                    catelog3Vo.setId(indexForCate3.toString());
                    catelog3Vo.setName(forCate3.getName());
                    indexForCate3.getAndSet(indexForCate3.get() + 1);
                    return catelog3Vo;
                }).collect(Collectors.toList());
                catelog2Vo.setCatelog3List(catelog3VoList);
                return catelog2Vo;
            }).collect(Collectors.toList());
            return catelog2VoList;
        }));
        return map;
    }
~~~

## host文件无法修改

![image-20220816233521069](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220816233521069.png)

![image-20220816233538998](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220816233538998.png)

![image-20220816233636276](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220816233636276.png)

## VM Option

-Xms 堆内存的初始大小，默认为物理内存的1/64。 -Xmx 堆内存的最大大小，默认为物理内存的1/4~1/2。 -Xmn 堆内新生代的大小。通过这个值也可以得到老生代的大小：-Xmx减去-Xmn。

-[Xss](https://so.csdn.net/so/search?q=Xss&spm=1001.2101.3001.7020) 设置每个线程可使用的内存大小，即栈的大小。

## redis堆外内存溢出

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817144830657.png)

## 缓存问题/redis作分布式锁

![image-20220817145246609](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817145246609.png)

![image-20220817145551871](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817145551871.png)

![image-20220817145913163](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817145913163.png)

![image-20220817151142972](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817151142972.png)

![image-20220817152325295](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817152325295.png)

![image-20220817152723310](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817152723310.png)

![image-20220817193728604](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817193728604.png)

![image-20220817194235486](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817194235486.png)

![image-20220817194320834](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817194320834.png)

![image-20220817195217719](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817195217719.png)

![image-20220817200309486](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817200309486.png)

![image-20220817200811303](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817200811303.png)

![image-20220817201134710](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817201134710.png)

![image-20220817201618559](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817201618559.png)

### 分布式锁代码

~~~java
 @Override
    public Map<String, List<Catelog2Vo>> getIndexJsonData() {
        String catelogJSON = redisTemplate.opsForValue().get("catelogJSON");
        if (StringUtils.isEmpty(catelogJSON)) {
            Map<String, List<Catelog2Vo>> indexJsonDataFromDb = getIndexJsonDataFromDbWithRedisLock();
            String s = JSON.toJSONString(indexJsonDataFromDb);
            redisTemplate.opsForValue().set("catelogJSON", s);
            return indexJsonDataFromDb;
        }
        System.out.println("缓存命中");
        Map<String, List<Catelog2Vo>> result = JSON.parseObject(catelogJSON, new TypeReference<Map<String, List<Catelog2Vo>>>() {
        });
        return result;
    }


    public Map<String, List<Catelog2Vo>> getIndexJsonDataFromDbWithRedisLock(){
        String uuid = UUID.randomUUID().toString();
        Boolean lock = redisTemplate.opsForValue().setIfAbsent("lock", uuid, 300, TimeUnit.SECONDS);
        if (lock){
            System.out.println("获取分布式锁成功");
            Map<String, List<Catelog2Vo>> indexJsonDataFromDb;
            try {
                indexJsonDataFromDb = getIndexJsonDataFromDb();
            }finally {
                String script = "if redis.call('get',KEYS[1]) == ARGV[1] then return redis.call('del',KEYS[1]) else return 0 end";
                redisTemplate.execute(new DefaultRedisScript<Long>(script,Long.class),Arrays.asList("lock"),uuid);
            }
            return indexJsonDataFromDb;
        }else {
            System.out.println("获取分布式锁失败...等待重试");
            try {
                Thread.sleep(300);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return getIndexJsonDataFromDbWithRedisLock();
        }
    }

//从数据库查询并封装数据
    public Map<String, List<Catelog2Vo>> getIndexJsonDataFromDb() {
        String catelogJSON = redisTemplate.opsForValue().get("catelogJSON");
        if (StringUtils.isEmpty(catelogJSON)){
            System.out.println("查询数据库");
            List<CategoryEntity> totalList = this.list();
            List<CategoryEntity> list = this.list(new QueryWrapper<CategoryEntity>().eq("parent_cid", 0).select("cat_id"));
            Map<String, List<Catelog2Vo>> map = list.stream().collect(Collectors.toMap(k -> k.getCatId().toString(), v -> {
                AtomicReference<Integer> indexForCate2 = new AtomicReference<>(1);
                AtomicReference<Integer> indexForCate3 = new AtomicReference<>(1);
                List<Catelog2Vo> catelog2VoList = totalList.stream().filter(cate -> {
                    return cate.getParentCid().equals(v.getCatId());
                }).map((forCate2) -> {
                    Catelog2Vo catelog2Vo = new Catelog2Vo();
                    catelog2Vo.setCatelog1Id(v.getCatId().toString());
                    catelog2Vo.setId(indexForCate2.toString());
                    indexForCate2.getAndSet(indexForCate2.get() + 1);
                    catelog2Vo.setName(forCate2.getName());
                    List<Catelog2Vo.Catelog3Vo> catelog3VoList = totalList.stream().filter(cate -> {
                        return cate.getParentCid().equals(forCate2.getCatId());
                    }).map(forCate3 -> {
                        Catelog2Vo.Catelog3Vo catelog3Vo = new Catelog2Vo.Catelog3Vo();
                        catelog3Vo.setCatelog2Id(catelog2Vo.getId());
                        catelog3Vo.setId(forCate3.getCatId().toString());
                        catelog3Vo.setName(forCate3.getName());
                        indexForCate3.getAndSet(indexForCate3.get() + 1);
                        return catelog3Vo;
                    }).collect(Collectors.toList());
                    catelog2Vo.setCatelog3List(catelog3VoList);
                    return catelog2Vo;
                }).collect(Collectors.toList());
                return catelog2VoList;
            }));
            String s = JSON.toJSONString(map);
            redisTemplate.opsForValue().set("catelogJSON",s);
            return map;
        }
        Map<String, List<Catelog2Vo>> result = JSON.parseObject(catelogJSON, new TypeReference<Map<String, List<Catelog2Vo>>>() {});
        return result;
    }
~~~



## 程序多开

![image-20220817153305027](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817153305027.png)

![image-20220817153238516](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817153238516.png)

![image-20220817230917560](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220817230917560.png)

## Redisson

### 可重入锁

![image-20220818092344409](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818092344409.png)

redisson的锁会自动续期，如果业务超长，运行期间会自动续上新的时长，保证锁不会被自动过期被删掉。

这里讲一下，当你宕机了，你宕机的那个设备还有看门狗嘛？所以宕机是没有看门狗给他续期的，他会自动过期。

如果线程段了，就不会续期了，到了30s之后就会被释放。如果业务时间很长，看门狗发现还在运行，才会续期。

自动续期是业务用时过长，超过了锁过期时间，会自动续期，但是面临宕机或异常中断时，就不会自动续期，而是在锁过期时间到了就自动释放了。

![image-20220818103151944](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818103151944.png)

![image-20220818094355026](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818094355026.png)

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818095634211.png)

![image-20220818095939197](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818095939197.png)

### 公平锁

![image-20220818100031372](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818100031372.png)

### 读写锁

![image-20220818100856561](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818100856561.png)

![image-20220818100912549](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818100912549.png)

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818102332454.png)

### 信号量

![image-20220818105423328](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818105423328.png)

### 闭锁

![image-20220818110703244](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818110703244.png)

## 使用redisson重写代码

![image-20220818112507175](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818112507175.png)

![image-20220818113319820](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818113319820.png)

![image-20220818113828445](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818113828445.png)

![image-20220818115257255](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818115257255.png)

![image-20220818115845296](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818115845296.png)

![image-20220818120413619](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818120413619.png)

![image-20220818120442116](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818120442116.png)

![image-20220818165026107](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818165026107.png)

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818172223097.png)

![image-20220818172501633](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220818172501633.png)

~~~java
public Map<String, List<Catelog2Vo>> getCatalogJsonFromDbWithRedissonLock() {

        //1、占分布式锁。去redis占坑
        //（锁的粒度，越细越快:具体缓存的是某个数据，11号商品） product-11-lock
        //RLock catalogJsonLock = redissonClient.getLock("catalogJson-lock");
        //创建读锁
        RReadWriteLock readWriteLock = redissonClient.getReadWriteLock("catalogJson-lock");

        RLock rLock = readWriteLock.readLock();

        Map<String, List<Catelog2Vo>> dataFromDb = null;
        try {
            rLock.lock();
            //加锁成功...执行业务
            dataFromDb = getIndexJsonDataFromDb();
        } finally {
            rLock.unlock();
        }
        //先去redis查询下保证当前的锁是自己的
        //获取值对比，对比成功删除=原子性 lua脚本解锁
        // String lockValue = stringRedisTemplate.opsForValue().get("lock");
        // if (uuid.equals(lockValue)) {
        //     //删除我自己的锁
        //     stringRedisTemplate.delete("lock");
        // }

        return dataFromDb;
~~~

## 浏览器缓存

如果更改了一些静态资源，但是浏览器始终无法更新，那么要么nginx没有重启，要么就是浏览器缓存没有清理，还是用到的之前缓存的数据。要让thymeleaf热更新的话：就要关闭thymeleaf的缓存。

~~~yml
spring:
	thymeleaf:
		cache: false
~~~

## 设置底部元素块居中

![image-20220819140442868](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220819140442868.png)

![image-20220819140515824](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220819140515824.png)

设置

~~~html
style="width: 1210px;margin: 0 auto"
~~~

## 程序画面自适应

![image-20220819153109555](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220819153109555.png)

## RestHighLevelClient

![image-20220819222405556](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220819222405556.png)

![image-20220819222527397](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220819222527397.png)

## @Bean

只要是@Component注解修饰的类里面都可以定义@Bean，并且都可以注册到Spring容器里面。其实不仅仅是@Component，只要是被@Component修饰的注解同样也可以定义@Bean，比如：@Repository、@Service、@Controller @Configuration，甚至是接口的default方法上的@Bean也可以被扫描加入到Spring容器里面。

## 修改带缓存的数据的接口

测试时一定记得先清理缓存！！！！！

## 获取原生的查询字符串

![image-20220821215605686](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220821215605686.png)

## 商品查询bug

### bool查询

![image-20220821221831516](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220821221831516.png)

### ik分词器

![image-20220822105129261](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220822105129261.png)

### 搜索js

```js
function searchByKeyword(){
    var href = location.href
    if (href.indexOf("keyword")!=-1){
        location.href = href.replace(/(?<=keyword=).*?(?=(""|&|$))/,$("#keyword").val());
     }else {
         this.searchProducts("keyword",$("#keyword").val())
     }
    location.href="http://search.gulimall.com/list.html?keyword="+$("#keyword").val();
}
```

### 一般不使用lambda修改外部变量

## 多线程

### 方式

1）、继承 Thread

 2）、实现 Runnable 接口 

3）、实现 Callable 接口 + FutureTask （可以拿到返回结果，可以处理异常）

4）、线程池 

方式 1 和方式 2：主进程无法获取线程的运算结果。不适合当前场景方式 3：主进程可以获取线程的运算结果，但是不利于控制服务器中的线程资源。可以导致服务器资源耗尽。 方式 4：通过如下两种方式初始化线程池

~~~java
Executors.newFiexedThreadPool(3);
//或者
new ThreadPoolExecutor(corePoolSize, maximumPoolSize, keepAliveTime, TimeUnit unit, workQueue, threadFactory, handler);
~~~

通过线程池性能稳定，也可以获取执行结果，并捕获异常。但是，在业务复杂情况下，一个异步调用可能会依赖于另一个异步调用的执行结果。

### 七大参数

~~~java
* @param corePoolSize the number of threads to keep in the pool, even* if they are idle, unless {@code allowCoreThreadTimeOut} isset池中一直保持的线程的数量，即使线程空闲。除非设置了 allowCoreThreadTimeOut* @param maximumPoolSize the maximum number of threads to allow inthe* pool
池中允许的最大的线程数
* @param keepAliveTime when the number of threads is greater than* the core, this is the maximum time that excess idle threads* will wait for new tasks before terminating. 当线程数大于核心线程数的时候，线程在最大多长时间没有接到新任务就会终止释放，最终线程池维持在 corePoolSize 大小
* @param unit the time unit for the {@code keepAliveTime} argument时间单位
* @param workQueue the queue to use for holding tasks before they are executed. This queue will hold only the {@code Runnable}
* tasks submitted by the {@code execute} method. 阻塞队列，用来存储等待执行的任务，如果当前对线程的需求超过了corePoolSize大小，就会放在这里等待空闲线程执行。
* @param threadFactory the factory to use when the executor
* creates a new thread
创建线程的工厂，比如指定线程名等
* @param handler the handler to use when execution is blocked
* because the thread bounds and queue capacities are reached拒绝策略，如果线程满了，线程池就会使用拒绝策略。
~~~

![image-20220822204541922](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220822204541922.png)

### 运行流程

1、线程池创建，准备好 core 数量的核心线程，准备接受任务 

2、新的任务进来，用 core 准备好的空闲线程执行。

 (1) 、core 满了，就将再进来的任务放入阻塞队列中。空闲的core 就会自己去阻塞队列获取任务执行

 (2) 、阻塞队列满了，就直接开新线程执行，最大只能开到 max 指定的数量

(3) 、max 都执行好了。Max-core 数量空闲的线程会在 keepAliveTime 指定的时间后自动销毁。最终保持到 core 大小

 (4) 、如果线程数开到了 max 的数量，还有新任务进来，就会使用reject 指定的拒绝策略进行处理 3、所有的线程创建都是由指定的 factory 创建的。

面试： 一个线程池 core 7； max 20 ，queue：50，100 并发进来怎么分配的；先有 7 个能直接得到执行，接下来 50 个进入队列排队，在多开 13 个继续执行。现在70 个被安排上了。剩下 30 个默认拒绝策略。

![image-20220822210401247](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220822210401247.png)

Future可以获取到异步结果，FutureTask是它的一个实现。

### 任务组合

![image-20220822214222487](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220822214222487.png)

![image-20220822214255547](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220822214255547.png)

![image-20220822214322074](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220822214322074.png)

![image-20220822214329815](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220822214329815.png)

![image-20220822214344087](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220822214344087.png)

**![image-20220822214358895](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220822214358895.png)**

![image-20220822215545460](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220822215545460.png)

## mysql查询顺序

![image-20220824211533251](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220824211533251.png)

![image-20220929220913142](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220929220913142.png)



~~~mysql
		SELECT
            ssav.attr_id attr_id,
            ssav.attr_name attr_name,
            ssav.attr_value,
			group_concat( DISTINCT info.sku_id ) sku_ids //聚合分组后每一个分组内的sku_id
        FROM
            pms_sku_info info
                LEFT JOIN pms_sku_sale_attr_value ssav ON ssav.sku_id = info.sku_id
        WHERE
            info.spu_id = 29
        GROUP BY
            ssav.attr_id,
            ssav.attr_name,
            ssav.attr_value
~~~

## 商品详情页bug

~~~js
$(".sku_attr_value").click(function () {
        // 1、点击的元素添加上自定义的属性
        let skus = new Array();
        let curr = $(this).attr("skus").split(",");

        $(this).parent().parent().find(".sku_attr_value").removeClass("checked");
        $(this).addClass("checked");
        changeCheckedStyle();

        $("a[class='sku_attr_value checked']").each(function () {
            skus.push($(this).attr("skus").split(","));
        });
        let filterEle = skus[0];
        for (let i = 1; i < skus.length; i++) {
            //多个数组取交集，由多个attr属性选择确定一个sku
            filterEle = filterEle.filter(v => skus[i].includes(v));
        }
        location.href = "http://item.gulimall.com/" + filterEle[0] + ".html";

        return false;
    });
~~~

如果无法跳转到item.gulimall.com/xx.html，检查：

是否配了本地host文件的域名配置；

是否在nginx里面配置了server_name  *.gulimall.com;并且要带上允许host的配置；

是否在gateway网关里面配置了路由；

是否写好了controller接口。

## controller报错post请求不被允许？

![image-20220825102751856](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220825102751856.png)

## session

![image-20220825181917129](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220825181917129.png)

![image-20220825182415979](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220825182415979.png)

![image-20220825182443376](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220825182443376.png)

![image-20220825182723922](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220825182723922.png)

![image-20220825183202665](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220825183202665.png)

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220825203837765.png)

## 单点登录

![image-20220825210238089](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220825210238089.png)

![image-20220825212637825](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220825212637825.png)

![image-20220825232500150](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220825232500150.png)

![单点登录流程](D:\java\guli_mall\谷粒商城\课件和文档\高级篇\课件\单点登录流程.png)

子系统到sso认证中心登录后，本地浏览器会以cookie的形式留下sso认证中心的登录痕迹并且sso认证中心会把cookie值和用户信息存入redis里面，sso认证中心重定向到子系统之前的访问地址并带上生成的cookie值，子系统再次验证是否登录，发现有返回了cookie值，说明已登录，所以直接再次访问sso认证中心去取用户信息，并且因为之前浏览器已经对sso认证中心留下了cookie痕迹，于是再次访问时会带上这个域名下的所有cookie去访问，而sso认证中心判断发现对方带了cookie来的，直接判定已登录过了，所以直接会拿着这个cookie里面的token到redis里面查找对应的用户信息，并将其返回给对方，对方拿到用户信息后存入本系统的session里面，这样下次再次访问时就先会去看session中是否有用户信息，有表明是已登录的，就不用再次去认证了。

## rabbitmq

![image-20220827085939688](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827085939688.png)

![image-20220827085958983](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827085958983.png)







![image-20220827085449868](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827085449868.png)

![image-20220827085506661](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827085506661.png)

![消息队列流程](D:\java\guli_mall\谷粒商城\课件和文档\高级篇\课件\消息队列流程.jpg)

![image-20220827085816766](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827085816766.png)

![image-20220827094141365](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827094141365.png)

![image-20220827100106366](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827100106366.png)

![image-20220827103426546](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827103426546.png)

![image-20220827103708737](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827103708737.png)

![image-20220827104350974](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827104350974.png)

![image-20220827104717180](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827104717180.png)

![image-20220827104939231](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827104939231.png)

![image-20220827105235125](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827105235125.png)

![image-20220827105316913](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827105316913.png)

![image-20220827105400148](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827105400148.png)

![image-20220827105922132](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827105922132.png)

![image-20220827110041317](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827110041317.png)

![image-20220827111040934](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827111040934.png)

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827111731340.png)

![image-20220827111854758](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827111854758.png)

![image-20220827112416363](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827112416363.png)

![image-20220827154405815](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827154405815.png)

![image-20220827155545309](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827155545309.png)

![image-20220827155646177](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827155646177.png)

![image-20220827155915473](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827155915473.png)

一但消费者启动起来，消息就会交给消费者，消费者挨个处理后就会确认消息送达，就是ack了。

![image-20220827160713262](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827160713262.png)

不签收的话，消息会在最后回到队列的ready状态。

生产者端的消息确认机制是在发布者-broker/交换机-消息队列这条线路上的；

消费者端的消息确认机制是在消息队列-消费者之间的。

![image-20220827161406558](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827161406558.png)

![image-20220827161751037](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827161751037.png)

![image-20220830202733945](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830202733945.png)

![image-20220830202756053](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830202756053.png)

![image-20220830202915156](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830202915156.png)

![image-20220830203713548](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830203713548.png)

![image-20220830204401889](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830204401889.png)

![消息队列流程](D:\java\guli_mall\谷粒商城\课件和文档\高级篇\课件\消息队列流程.jpg)

![image-20220831102603997](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220831102603997.png)

![image-20220831102737661](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220831102737661.png)

![image-20220831103057098](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220831103057098.png)



## Feign远程调用丢失请求头

~~~java
package com.atguigu.gulimall.order.config;

import feign.RequestInterceptor;
import feign.RequestTemplate;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletRequest;

@Configuration
public class GuliFeignClient {

    @Bean
    public RequestInterceptor requestInterceptor(){
        return new RequestInterceptor() {
            @Override
            public void apply(RequestTemplate requestTemplate) {
                ServletRequestAttributes requestAttributes = (ServletRequestAttributes)RequestContextHolder.getRequestAttributes();
                HttpServletRequest request = requestAttributes.getRequest();
                if (request != null){
                    String cookies = request.getHeader("Cookie");
                    requestTemplate.header("Cookie",cookies);
                }
            }
        };
    }
}

~~~



![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221004130029821.png)

![image-20220827181546707](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827181546707.png)

![image-20220827181752586](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827181752586.png)

## Feign远程调用丢失上下文

![image-20220827182807563](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827182807563.png)

![image-20220827183040143](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827183040143.png)

![image-20220827183320100](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827183320100.png)

![image-20220827183443130](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827183443130.png)

## @RequestBody只能接收json

![image-20220827225355754](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827225355754.png)



![image-20220827225502350](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827225502350.png)

## addAttribute（）与addFlashAttribute（）

![image-20220827232806625](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827232806625.png)

![image-20220827232921315](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220827232921315.png)

## 复习ajax

```js
 $.ajax({
   type:"post",
   url:"http://auth.gulimall.com/register",
   data:JSON.stringify({"phone":$( "input[name='phone']").val(),"userName":$( "input[name='userName']").val(),"code":$( "input[name='code']").val(),"password":$( "input[name='password']").val()}),//以json形式发送数据，要把数据转为json
   contentType:'application/json',
   success:function (res){//成功回调的函数名为success
      console.log(res)
      if (res.code == 0){
         alert("注册成功！正在跳转登录...")
         windows.href="http://auth.gulimall.com/login.html"
      }else {
         console.log(res)
         if (res.phone){
            $( "div[name='error_phone']").text(res.phone)
         }
         if (res.userName){
            $( "div[name='error_username']").text(res.userName)
         }
         if (res.error_code){
            $( "div[name='error_code']").text(res.error_code)//给指定name的div赋值
         }
      }
   }
})
```

![image-20220828005509874](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220828005509874.png)

![image-20220828011225641](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220828011225641.png)

## 接口幂等性

![image-20220828104236225](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220828104236225.png)

![image-20220828104447892](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220828104447892.png)

### 解决方案

![image-20220828105030709](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220828105030709.png)

![image-20220828105108281](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220828105108281.png)

![image-20220828105127916](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220828105127916.png)

![image-20220828105138258](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220828105138258.png)

#### 神奇的lua脚本

![image-20220828114044781](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220828114044781.png)



## 基础坑

```java
@Test
void contextLoads() {
    Integer[] ints = {1, 2, 3, 4, 5, 6, 7, 7, 7, 3, 29, 1, 90};
    List<Integer> collect = Arrays.stream(ints).distinct().collect(Collectors.toList());
    System.out.println(collect);
}//list里面只能是引用数据类型对象，不能是基本数据类型。
```



## springsession未生效

![image-20220830090132470](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830090132470.png)

~~~java
@Configuration
public class GulimallSessionConfig {
    @Bean
    public CookieSerializer cookieSerializer(){
        DefaultCookieSerializer defaultCookieSerializer = new DefaultCookieSerializer();
        defaultCookieSerializer.setDomainName("gulimall.com");
        defaultCookieSerializer.setCookieName("GULISESSION");
        return defaultCookieSerializer;
    }
    @Bean
    public RedisSerializer<Object> springSessionDefaultRedisSerializer() {
        return new GenericJackson2JsonRedisSerializer();
    }
}
~~~

springsession的配置被放到了common模块，所以必须在使用了该bean的模块加上@ComponentScan({"com.atguigu"})注解！

![image-20220830090355892](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830090355892.png)

## 事务传播行为：本地事务失效

![image-20220830110304090](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830110304090.png)

![image-20220830110630496](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830110630496.png)

![image-20220830110728915](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830110728915.png)

## CAP

![image-20220830111946445](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830111946445.png)

![image-20220830112155022](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830112155022.png)

![image-20220830112421371](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830112421371.png)

http://thesecretlivesofdata.com/raft/

![image-20220830115625481](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830115625481.png)

![image-20220830115355902](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830115355902.png)

![image-20220830115519277](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830115519277.png)

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830122323930.png)

![image-20220830121727005](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830121727005.png)

![image-20220830124428273](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830124428273.png)

![image-20220830124537523](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830124537523.png)

![image-20220830124653510](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830124653510.png)

## 分布式事务方案

### 2PC模式

![image-20220830124956952](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830124956952.png)

### 柔性事务-TCC 事务补偿型方案

![image-20220830125437829](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830125437829.png)

### 柔性事务-最大努力通知型方案

![image-20220830125511035](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830125511035.png)

### 柔性事务-可靠消息+最终一致性方案（异步确保型）

![image-20220830125524035](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830125524035.png)

## seata

![image-20220830130141667](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830130141667.png)

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830130129576.png)

![image-20220830130442523](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220830130442523.png)

## 加密

![image-20220904085337036](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220904085337036.png)

![image-20220904085350389](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220904085350389.png)

![image-20220904085829293](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220904085829293.png)

![image-20220904090750094](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220904090750094.png)

![image-20220904091632450](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220904091632450.png)

![image-20220904092459932](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220904092459932.png)

![image-20220904093617754](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220904093617754.png)

![image-20220906201447738](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220906201447738.png)

![image-20220906203218046](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220906203218046.png)



## thymleaf行内表达式

![image-20220904232229059](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220904232229059.png)

## 两个非常神奇的bug

一个是无法通过@ModelRedirect获取到redirectAttribute发来的flashAttribute;

一个是通过整合github联合登录可以将session通过springsession放到redis里面，并且可以被其它加入了springsession的服务获取到对应的session,但是却在整合微信联合登录时，同样的操作其它服务却无法获取到对应的session。



## Schedule

![image-20220907200658362](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220907200658362.png)

![image-20220907201030513](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220907201030513.png)

![image-20220907201144192](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220907201144192.png)

![image-20220907202626813](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220907202626813.png)

![image-20220907203541113](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220907203541113.png)

![image-20220907203738615](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220907203738615.png)

![image-20220907203806473](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220907203806473.png)

![image-20220907203854244](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220907203854244.png)

![image-20220907223729178](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220907223729178.png)

## sentinel

![image-20220910170621052](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220910170621052.png)

![image-20220910171455350](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220910171455350.png)

## HashMap定制容量

![image-20220918211853732](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220918211853732.png)

~~~java
    public HashMap(int initialCapacity, float loadFactor) {
        if (initialCapacity < 0)
            throw new IllegalArgumentException("Illegal initial capacity: " +
                                               initialCapacity);
        if (initialCapacity > MAXIMUM_CAPACITY)
            initialCapacity = MAXIMUM_CAPACITY;
        if (loadFactor <= 0 || Float.isNaN(loadFactor))
            throw new IllegalArgumentException("Illegal load factor: " +
                                               loadFactor);
        this.loadFactor = loadFactor;
        this.threshold = tableSizeFor(initialCapacity);
    }
     public HashMap(int initialCapacity) {
        this(initialCapacity, DEFAULT_LOAD_FACTOR);
    }

~~~

~~~java
    /**
     * Returns a power of two size for the given target capacity.
     */
    static final int tableSizeFor(int cap) {
        int n = cap - 1;
        n |= n >>> 1;//>>>是无符号位运算
        n |= n >>> 2;
        n |= n >>> 4;
        n |= n >>> 8;
        n |= n >>> 16;
        return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
    }

~~~

![image-20220918212029913](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220918212029913.png)

![image-20220923111909082](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20220923111909082.png)

## css：position:absolute/relative

![image-20221002203030763](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002203030763.png)

![image-20221002203132305](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002203132305.png)

![image-20221002203149014](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002203149014.png)

![image-20221002203208093](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002203208093.png)

![image-20221002203230160](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002203230160.png)

![image-20221002203239697](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002203239697.png)

![image-20221002203255345](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002203255345.png)

absolute布局不占空间,脱离文档流

![image-20221002210637127](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002210637127.png)



float属于半脱离文档流，浮动与浮动之间仍然相互影响位置，但是浮动不会占据文档流元素的位置，float不影响absolute盒子的空间。

absolute是先确定原位置，再根据非static的父元素来确定最终位置。没有设置top,left,right,bottom的话position:absolute，元素停留在原位置，但是浮动效果依然在。

~~~html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="div-t">
    <div>
        <div class="div1">
            <div class="div2">//float的元素不影响position:absolute的元素
            </div>
            <div class="div3">//position:absolute的元素没有设置top,left,right,bottom，依然由浮动效果，不占据空间。
                position: absolute
            </div>
            <div style="width: 200px;height: 200px;border: black 2px solid;"></div>
        </div>
    </div>
    <div style="height: 100px;width: 100px;border: blue 2px solid;position: absolute;">
        position:absolute
    </div>
    <div style="height: 300px;width: 300px;border:indigo 2px solid;"></div>
</div>

</body>

</html>

<style type="text/css">
    .div-t{
        position: relative;
        /*overflow: hidden;*/
        z-index: 999;
    }
    .div1{
        position: relative;
        height: 300px;
        border: green 2px solid;
        width: 1600px;
    }
    .div2{
        float: left;
        width:100px;
        height: 50px;
        border: #0BB2D4 2px solid;
    }
    .div3{
        position: absolute;
        /*float: right;*/
        /*top: 0;*/
        /*right: 0;*/
        width: 100px;
        height: 100px;
        border: red 2px solid;
}
</style>

~~~

![](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221003010349319.png)

值得注意的是：如果float被overflow:hidden清除了浮动，float元素的浮动效果依然在，但是它不占据position:absolute的元素

的空间，但是对于非position:absolute的元素会导致其虽然可以在其位置上放置元素但是内容会被清除了浮动的元素排挤。这可能

就是因为float的半脱离文档流状态导致的。***脱离文档流但是又占据位置。清除浮动只是从父元素的角度看撑开了自己，从观感上达到了清除内部浮动的效果，但是浮动元素的半脱离文档流效果依然存在。***

~~~html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="div-t">
    <div>
        <div class="div1">
            <div class="div2">
            </div>
            <div style="width: 300px;height: 60px;border: darkorange 2px solid;left: 5px;position: absolute"> position:absolute</div>
            <div style="float: left;width: 50px;height: 50px;border: black 2px solid;"></div>
            <div class="div3">
                position: static
            </div>
            <div style="width: 200px;height: 200px;border: black 2px solid;"></div>
        </div>
    </div>
    <div style="height: 100px;width: 100px;border: blue 2px solid;position: absolute;">position: absolute</div>
    <div style="height: 300px;width: 300px;border:indigo 2px solid;"></div>
</div>
</body>

</html>

<style type="text/css">
    .div-t{
        position: relative;
        overflow: hidden;//即使加了清除浮动，本质上不会清除子元素的float效果，而是计算div-t高度时会把内部浮动元素的高度加入                            进来，在没有清除浮动前，内部浮动元素由于脱离文档流，不会将外部父元素撑开导致未设置大小的父元素坍                            塌。清除浮动只是从父元素的角度看清除了，但是浮动元素的半脱离文档流效果依然在。
        z-index: 999;
    }
    .div1{
        position: relative;
        overflow: hidden;
        /*height: 300px;*/
        border: green 2px solid;
        width: 1600px;
    }
    .div2{
        float: left;
        width:100px;
        height: 100px;
        border: #0BB2D4 2px solid;
    }
    .div3{
        /*position: absolute;*/
        /*float: right;*/
        /*top: 0;*/
        /*left: 100px;*/
        width: 200px;
        height: 150px;
        border: red 2px solid;
}
</style>

~~~

![image-20221003092550106](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221003092550106.png)

受到排挤就是因为float块是半脱离文档流的。

![image-20221002211317218](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002211317218.png)

![image-20221002212215826](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002212215826.png)



## z-index只对设置了position的盒子生效

![image-20221002222258991](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221002222258991.png)

## css高级-BFC清除浮动

### 一

overflow:hidden 的意思是超出的部分要裁切隐藏掉

那么如果 float 的元素不占普通流位置

普通流的包含块要根据内容高度裁切隐藏

如果高度是默认值auto

那么不计算其内浮动元素高度就[裁切](https://www.zhihu.com/search?q=裁切&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A50036974})

就有可能会裁掉float

这是反布局常识的

所以如果没有明确设定容器高情况下

它要计算内容全部高度才能确定在什么位置hidden

浮动的高度就要被计算进去

顺带达成了清理浮动的目标

### 二

首先，这确实是BFC（Block fomatting context [块级格式化](https://www.zhihu.com/search?q=块级格式化&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A324582230})上下文）渲染的结果。

导致这种结果的原因如下：

[BFC](https://www.zhihu.com/search?q=BFC&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A324582230})的定义：

BFC是一个独立的渲染区域，只有Block-level box参与， 它规定了内部的Block-level Box如何布局，**并且与这个区域外部毫不相干**。

BFC的规则（只列出需要的）：

1. BFC就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。
2. 计算BFC的高度时，[浮动元素](https://www.zhihu.com/search?q=浮动元素&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A324582230})也参与计算。

哪些元素会产生BFC（只列出需要的）：

1. overflow不为visible

好了，让我们根据上面的条件推导出结果：

1. 当你为一个元素添加overflow属性为hidden时，这个元素就会产生自己的BFC。
2. 根据规则2，**在计算BFC的高度时，浮动元素的高度也要参与计算**，即父元素不会忽略自己里面的浮动元素的高度，如果你的父元素的高度设置的auto的话，那么它的高度就会等于浮动元素的高度（假设这个BFC里面只有一个浮动元素）。
3. 规则2也是为了保证规则1的所述，即BFC就是页面上的一个隔离的独立容器，容器里面的子元素不应该影响到外面的元素，如果父元素不计算浮动元素的高度而是坍塌的话，那么浮动元素就会影响到其后面的元素，所以它需要规则3来保证这么一个行为。
4. 当然，**你可以说我就选择坍塌，然后把多余的浮动元素裁剪掉**，这样也不影响后面的元素，难道不行吗？**当然可以，所以才有了规则3明确表示我们采取的措施就是计算浮动元素的高度来不影响后面的元素**。
5. 最后，这并没有违背overflow: hidden;的功能，**它的裁剪的功能依旧存在，只是说现在它的高度被自动设置成了能够包含浮动元素的高度罢了**（如果height: auto; ）。所以如果你显示的声明父元素的高度，那么浮动元素超出的部分也是会被裁剪掉的，**这跟违背hidden的本意没有任何关联**。

![image-20221003000236959](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221003000236959.png)

![image-20221003000757870](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221003000757870.png)

overflow:hidden不会将position:absolute的子元素加入裁剪的高度计算，并且只要overflow:hidden不放到position:absolute的子元素用于定位的父元素上，那么这个子元素将也不受裁剪的影响。

![image-20221003002157724](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221003002157724.png)

## springboot里面默认禁止直接访问templates里面的内容

![image-20221003222009808](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221003222009808.png)

可以通过controller来进行视图跳转。



## feign调用允许双方返回类型不一致

![image-20221004161458662](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221004161458662.png)

## 支付宝沙箱

SDK&DEMO

https://opendocs.alipay.com/open/270/106291?ref=api

使用说明

https://opendocs.alipay.com/common/02kkv7#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E9%85%8D%E7%BD%AE%E6%B2%99%E7%AE%B1%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83

## 注册拦截器正确姿势

~~~java

@Configuration
public class OrderWebConfig implements WebMvcConfigurer {

    @Autowired
    private LoginUserInterceptor loginUserInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(loginUserInterceptor).addPathPatterns("/**");
    }
}

~~~

## natapp内网穿透

### natapp的免费隧道提供的域名每次重启都会改变

![image-20221008181538441](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221008181538441.png)

![image-20221008181758008](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20221008181758008.png)

